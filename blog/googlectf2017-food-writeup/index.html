<!DOCTYPE html>
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />

<title>Google CTF 2017 food writeup</title>
<link rel="stylesheet" type="text/css" href="style/normalize.css" media="screen">
<link rel="stylesheet" type="text/css" href="style/stylesheet.css" media="screen">
<link rel="stylesheet" type="text/css" href="style/github-light.css" media="screen">
<link rel="stylesheet" type="text/css" href="style/menu.css" media="screen">
<link rel="stylesheet" type="text/css" href="style/special.css" media="screen">
</head>
<body>
<!-- æ–‡ç« å¯¼èˆªæ¡ -->
<nav class="nav">
	<ul>
		<li class="current"><a href="http://www.ahageek.com/">é¦–é¡µ</a></li>
		<li><a href="http://www.ahageek.com/blog/blog-index.html">æ–‡ç« ç›®å½•</a></li>
	</ul>
</nav>
<!--æ–‡ç« æ ‡é¢˜-->
<section class="page-header">
      <h1 class="project-name">Google CTF 2017 food writeup</h1>
      <!--<h2>SUBTITLE</h2>-->
      <h3 class="project-tagline">2018-05-04 by Bugnofree</h3>
</section>
<!--æ–‡ç« æ¦‚è§ˆ-->
<!--<div class="treebox">-->
    <!--<ul class="tree">-->
        <!--<li><a>ä¸€çº§æ ‡é¢˜</a>-->
            <!--<ul>-->
                <!--<li><a>äºŒçº§æ ‡é¢˜</a>-->
                    <!--<ul>-->
                        <!--<li><a>ä¸‰çº§æ ‡é¢˜</a></li>-->
                        <!--<li><a>ä¸‰çº§æ ‡é¢˜</a></li>-->
                        <!--<li><a>ä¸‰çº§æ ‡é¢˜</a></li>-->
                    <!--</ul>-->
                <!--</li>-->
                <!--<li><a>äºŒçº§æ ‡é¢˜</a></li>-->
            <!--</ul>-->
       <!--</li>-->
    <!--</ul>-->
<!--</div>-->
<!--ä»¥ä¸‹å¼€å§‹å†™æ–‡ç« -->
<!--=================================================================-->
<!--èƒŒæ™¯ä¿¡æ¯-->
<h3 class="text3d">èƒŒæ™¯ && æ‘˜è¦</h3>
<p>å°±æ˜¯æƒ³å¤šåšå‡ é“ Android é€†å‘é¢˜ç›®äº†.</p>

<h3 class="text3d">ç¯å¢ƒ</h3>
<p>macos 10.13 + IDA 7.0 + Jadx</p>
<!--æ­£æ–‡-->
<h1 class="titlebar">çº¯é™æ€åˆ†ææ±‚è§£ flag</h1>
<p>
æ¨¡æ‹Ÿå™¨å®‰è£…ç¨‹åºåç›´æ¥æŒ‚æ‰,è¿è¡Œä¸äº†,äºæ˜¯é™æ€åˆ†æä¹‹.
ç”¨ jadx æ‰“å¼€æ”¹ç¨‹åº,å¦‚ä¸‹
<img src="./images/jadx-decomp.png" alt="">
æ²¡å•¥ä¸œè¥¿,å°±æ˜¯åŠ è½½äº†ä¸€ä¸ª so åº“, ç”¨ IDA æ‰“å¼€è¿™ä¸ª so åº“. å®šä½åˆ° JNI_OnLoad å‡½æ•°ä¸­,
æ˜ å…¥çœ¼å¸˜çš„æ˜¯ä¸€å¤§å¨æ•°å­—,å¦‚ä¸‹
<img src="./images/decrypt_str.png" alt="">
åæ¥åˆ†æå,è¿™ä¸ªå‡½æ•°å¼ç”¨äºä»è¿™ä¸€å¤§å¨æ•°å€¼ä¸­è§£å¯†å‡ºæ¥ä¸€ä¸ªå­—ç¬¦ä¸²,
ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ•°å€¼çš„ä¸ªæ•°,å…¶ä»–å‚æ•°å°±æ˜¯æ•°å€¼äº†. ç”¨ IDA F5 å¾—åˆ°è¿™ä¸ªå‡½æ•°å¦‚ä¸‹
</p>

<pre style="background-color:#272822;color:#d0d0d0;padding:1%;border-radius:20px;line-height:10px;">
<font face="monospace">
_BYTE *decrypt_str(<font color="#87af5f">int</font>Â a1, ...)<br/>
{<br/>
Â Â <font color="#87af5f">int</font>Â v1;Â <font color="#875f87"><i>// r4</i></font><br/>
Â Â _BYTE *result;Â <font color="#875f87"><i>// r0</i></font><br/>
Â Â _BYTE *mem;Â <font color="#875f87"><i>// r2</i></font><br/>
Â Â <font color="#87af5f">int</font>Â i;Â <font color="#875f87"><i>// r3</i></font><br/>
Â Â <font color="#87af5f">int</font>Â num;Â <font color="#875f87"><i>// r1</i></font><br/>
Â Â <font color="#87af5f">int</font>Â varg_r0;Â <font color="#875f87"><i>// [sp+28h] [bp-10h]</i></font><br/>
Â Â <font color="#87af5f">va_list</font>Â varg_r1;Â <font color="#875f87"><i>// [sp+2Ch] [bp-Ch]</i></font><br/>
<br/>
Â Â va_start(varg_r1, a1);<br/>
Â Â varg_r0 = a1;<br/>
Â Â v1 =Â <font color="#d7875f">2</font>Â * a1;<br/>
Â Â result = j_malloc(<font color="#d7875f">2</font>Â * a1 +Â <font color="#d7875f">1</font>);<br/>
Â Â mem = result;<br/>
Â Â i =Â <font color="#d7875f">0</font>;<br/>
Â Â <font color="#ffd75f">while</font>Â ( i &lt; varg_r0 )<br/>
Â Â {<br/>
Â Â Â Â num = *(varg_r1 + i++);<br/>
Â Â Â Â *mem = ~((~num | ((num &amp;Â <font color="#d7875f">0xFF00</font>) &gt;&gt;Â <font color="#d7875f">8</font>)) &amp; (~((num &amp;Â <font color="#d7875f">0xFF00</font>) &gt;&gt;Â <font color="#d7875f">8</font>) | num));<br/>
Â Â Â Â mem[<font color="#d7875f">1</font>] = HIBYTE(num) ^ ((num &amp;Â <font color="#d7875f">0xFF0000u</font>) &gt;&gt;Â <font color="#d7875f">16</font>);<br/>
Â Â Â Â mem +=Â <font color="#d7875f">2</font>;<br/>
Â Â }<br/>
Â Â result[v1] =Â <font color="#d7875f">0</font>;<br/>
Â Â <font color="#ffd75f">return</font>Â result;<br/>
}<br/>
</font>
</pre>

<p>ç„¶åæ‰‹åŠ¨ç”¨ python å®ç°ä¸€ä¸ª</p>

<pre style="background-color:#272822;color:#d0d0d0;padding:1%;border-radius:20px;line-height:10px;">
<font face="monospace">
<font color="#875f87"><i>#! /usr/bin/env python3</i></font><br/>
<font color="#875f87"><i>#! -*- coding:utf-8 -*-</i></font><br/>
<br/>
<font color="#ffd75f">def</font>Â <font color="#878787">solve</font>(lst):<br/>
Â Â Â Â result = []<br/>
Â Â Â Â <font color="#ffd75f">for</font>Â numstrÂ <font color="#ffd75f">in</font>Â lst:<br/>
Â Â Â Â Â Â Â Â num =Â <font color="#878787">int</font>(numstr)<br/>
Â Â Â Â Â Â Â Â chaint = ~((~num | ((num &amp;Â <font color="#d7875f">0xFF00</font>) &gt;&gt;Â <font color="#d7875f">8</font>)) &amp; (~((num &amp;Â <font color="#d7875f">0xFF00</font>) &gt;&gt;Â <font color="#d7875f">8</font>) | num))<br/>
Â Â Â Â Â Â Â Â cha = chaint &amp;Â <font color="#d7875f">0xff</font><br/>
Â Â Â Â Â Â Â Â chbint = ((num &amp;Â <font color="#d7875f">0xFF000000</font>) &gt;&gt;Â <font color="#d7875f">24</font>) ^ ((num &amp;Â <font color="#d7875f">0xFF0000</font>) &gt;&gt;Â <font color="#d7875f">16</font>)<br/>
Â Â Â Â Â Â Â Â chb = chbint &amp;Â <font color="#d7875f">0xff</font><br/>
Â Â Â Â Â Â Â Â result.append(<font color="#878787">chr</font>(cha))<br/>
Â Â Â Â Â Â Â Â result.append(<font color="#878787">chr</font>(chb))<br/>
Â Â Â Â rst =Â <font color="#afaf87"><i>''</i></font>.join(result)<br/>
Â Â Â Â <font color="#878787">print</font>(rst)<br/>
Â Â Â Â <font color="#ffd75f">return</font>Â rst<br/>
</font>
</pre>

<p>
ä¼ å…¥çš„å‚æ•°ä¸ºæ•°å€¼åˆ—è¡¨,æ¯”å¦‚ solve([1142966885, 90266995, 459477109])è¾“å‡ºçš„è§£å¯†å­—ç¬¦ä¸²ä¸º
<b class="term">/d.dex</b>.
è½¬æ¢åˆ° python ä»£ç çš„è¿‡ç¨‹æ˜¯è¿™æ ·çš„,æˆ‘ä»¬çœ‹ C ä»£ç ä¸­æ˜¯å¯¹æ¯ä¸€ä¸ªæ•´æ•°åšä¸€ä¸‹ç»„åˆè¿ç®—èµ‹å€¼ç»™ *mem,
è€Œæˆ‘ä»¬ç”± mem += 2 å®é™…ä¸Šå¯ä»¥ç¡®å®šä¸€æ¬¡å¾—åˆ°ä¸¤ä¸ªå­—èŠ‚, *mem å¤„ç¡®å®šçš„æ˜¯ç¬¬ä¸€ä¸ªå­—èŠ‚,
ç”±äº mem çš„å…ƒç´ æ˜¯å­—èŠ‚ç±»å‹çš„,æ‰€ä»¥ *mem å¤„å®é™…ä¸Šå¾—åˆ°äº†è¡¨è¾¾å¼ç»“æœçš„æœ€ä½å­—èŠ‚,
è€Œ mem[1] åˆ™ç¡®å®šç¬¬äºŒä¸ªå­—èŠ‚. åœ¨ IDA ä¸­,
<b class="term">HIBYTE(num)</b> å–å¾—æ•´æ•° num çš„æœ€é«˜ä¸€å­—èŠ‚. æ‰€ä»¥,
ç›¸åº”çš„åœ¨ python ä¸­å°±æ˜¯ (num & 0xFF000000) &gt;&gt; 24,å‰©ä¸‹çš„è½¬æ¢å°±æ˜¯ç…§æ¬äº†.
</p>

<p>
æˆ‘ä»¬å¯ä»¥å¯¹æ‰€æœ‰å­—ç¬¦ä¸²è¿›è¡Œè§£å¯†,è§£å¯†åå¤§è‡´æµè§ˆä¸€ä¸‹ JNI_OnLoad ä¸­çš„ä»£ç ,
å¯ä»¥çœ‹åˆ°è¿™é‡Œè½¬å‚¨ç”Ÿæˆä¸€ä¸ª dex æ–‡ä»¶,å¦‚ä¸‹:
<img src="./images/saveddex.png" alt="">
æ ¹æ® fwrite çš„å‚æ•°,æˆ‘ä»¬çŸ¥é“æ˜¯ä» libcook.so åç§» 0x2F18 å¤„è¯»å…¥ 0x15A8 ä¸ªå­—èŠ‚åˆ°æŸä¸ªæ–‡ä»¶,
è¿™ä¸ªæ–‡ä»¶æ˜¯çœŸå®çš„ dex æ–‡ä»¶,ä½†è¿™ä¸ªæ–‡ä»¶å®é™…ä¸Šå¹¶ä¸èƒ½æ“ä½œæˆåŠŸ,
ä¸è¿‡è¿™é‡Œæˆ‘ä»¬ä¸å…³å¿ƒ,å› ä¸ºæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨æå–.
ç„¶ååé¢æ˜¯ä¸€ç³»åˆ—å…¶ä»–æ“ä½œ,æ¯”å¦‚ç§»é™¤ç”Ÿæˆçš„ dex æ–‡ä»¶æ“ä½œ,è·å–ç±»åŠ è½½å™¨ç­‰,
ä¸è¿‡å¯¹æˆ‘ä»¬ç”¨å¤„ä¸å¤§,åœ¨ JNI_OnLoad æœ«å°¾æœ‰è¿™ä¹ˆä¸€ä¸ªæ“ä½œå¦‚ä¸‹
<img src="./images/decrypt-tail.png" alt="">
è¿™é‡Œçš„ decrypt_app å‡½æ•°å®é™…ä¸Šæ˜¯å¯¹ dex æ–‡ä»¶è¿›è¡Œäº†è¿›ä¸€æ­¥è§£å¯†,çœ‹çœ‹è¿™ä¸ªå‡½æ•°çš„æ ·å­,
å¦‚ä¸‹
<img src="./images/decrypt_app.png" alt="">
</p>

<p>
å› ä¸ºåœ¨ JNI_OnLoad ä¸­ç§»é™¤äº† dex æ–‡ä»¶,ä½†æ˜¯è¯¥ dex æ–‡ä»¶è¿˜ä½äºå†…å­˜ä¸­,
ä¸ºäº†å¾—åˆ° dex çš„å†…å®¹,éå†è¿›ç¨‹ç©ºé—´ /proc/self/maps æœç´¢ d.dex,
å¹¶ä¸”åªæœ‰å½“æœç´¢åˆ°çš„å†…å­˜åŒºåŸŸå‰å››ä¸ªå­—èŠ‚ä¸º 'dex\n0' æ—¶æ‰ç®—æ‰¾åˆ°.
ä¸»è¦è§£å¯†ä»£ç å°±æ˜¯çº¢æ¡†éƒ¨åˆ†. ä¸Šå›¾ä¸­æœ‰ä¸€ä¸ªå¾ˆå¥‡æ€ªçš„åœ°æ–¹æ˜¯,
IDA ç»™äº†æˆ‘ä»¬ä¸€ä¸ª v9=&i[-v6], -v6 æ˜¯ä»€ä¹ˆé¬¼,æ­¤æ—¶å›åˆ°æ±‡ç¼–ä¸­çœ‹ä¸€ä¸‹
<img src="./images/negindex.png" alt="">
çº¢æ¡†ä¸­çš„éƒ¨åˆ†å°±æ˜¯ä¸Šé¢çš„ä¼ªä»£ç éƒ¨åˆ†,ä¹Ÿå°±æ˜¯è¯´ v9 å®é™…ä¸Šæ˜¯ 0.
ç„¶åæ ¹æ®ä¼ªä»£ç å¯ä»¥çŸ¥é“å¤åˆ¶ libcook.so åç§» 0x2E88 å¤„çš„ 0x90 ä¸ªå­—èŠ‚,
å°†æ¯ä¸ªå­—èŠ‚å’Œ 0x5A å¼‚æˆ–å¤„ç†åä¾æ¬¡å­˜æ”¾åˆ° dex åç§» 0x720 å¤„,
æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨ python æ¥å®ç°è¿™ä¸€åŠŸèƒ½:
</p>

<pre style="background-color:#272822;color:#d0d0d0;padding:1%;border-radius:20px;line-height:10px;">
<font face="monospace">
<font color="#ffd75f">with</font>Â <font color="#878787">open</font>(<font color="#afaf87"><i>"</i></font><font color="#afaf87"><i>./lib/armeabi/libcook.so</i></font><font color="#afaf87"><i>"</i></font>,Â <font color="#afaf87"><i>"</i></font><font color="#afaf87"><i>rb</i></font><font color="#afaf87"><i>"</i></font>)Â <font color="#ffd75f">as</font>Â libcook:<br/>
Â Â Â Â libcook.seek(<font color="#d7875f">0x2f18</font>)<br/>
Â Â Â Â patched_ddex =Â <font color="#878787">bytearray</font>(libcook.read(<font color="#d7875f">0x15a8</font>))<br/>
<br/>
data = [<br/>
<font color="#d7875f">0x49</font>,Â <font color="#d7875f">0x5E</font>,Â <font color="#d7875f">0x52</font>,Â <font color="#d7875f">0x5A</font>,Â <font color="#d7875f">0x79</font>,Â <font color="#d7875f">0x1B</font>,Â <font color="#d7875f">0x7B</font>,Â <font color="#d7875f">0x5A</font>,Â <font color="#d7875f">0x7C</font>,<br/>
<font color="#d7875f">0x5B</font>,Â <font color="#d7875f">0x66</font>,Â <font color="#d7875f">0x5A</font>,Â <font color="#d7875f">0x5A</font>,Â <font color="#d7875f">0x5A</font>,Â <font color="#d7875f">0x48</font>,Â <font color="#d7875f">0x5A</font>,Â <font color="#d7875f">0x6F</font>,Â <font color="#d7875f">0x1A</font>,<br/>
<font color="#d7875f">0x55</font>,Â <font color="#d7875f">0x5A</font>,Â <font color="#d7875f">0x12</font>,Â <font color="#d7875f">0x58</font>,Â <font color="#d7875f">0x5B</font>,Â <font color="#d7875f">0x5A</font>,Â <font color="#d7875f">0xE</font>,Â <font color="#d7875f">9</font>,Â <font color="#d7875f">0x5F</font>,Â <font color="#d7875f">0x5A</font>,<br/>
<font color="#d7875f">0x12</font>,Â <font color="#d7875f">0x59</font>,Â <font color="#d7875f">0x59</font>,Â <font color="#d7875f">0x5A</font>,Â <font color="#d7875f">0xED</font>,Â <font color="#d7875f">0x68</font>,Â <font color="#d7875f">0xD7</font>,Â <font color="#d7875f">0x78</font>,Â <font color="#d7875f">0x15</font>,<br/>
<font color="#d7875f">0x58</font>,Â <font color="#d7875f">0x5B</font>,Â <font color="#d7875f">0x5A</font>,Â <font color="#d7875f">0x82</font>,Â <font color="#d7875f">0x5A</font>,Â <font color="#d7875f">0x5A</font>,Â <font color="#d7875f">0x5B</font>,Â <font color="#d7875f">0x72</font>,Â <font color="#d7875f">0xA8</font>,<br/>
<font color="#d7875f">0x78</font>,Â <font color="#d7875f">0x5A</font>,Â <font color="#d7875f">0x45</font>,Â <font color="#d7875f">0x5A</font>,Â <font color="#d7875f">0x2A</font>,Â <font color="#d7875f">0x7A</font>,Â <font color="#d7875f">0x7E</font>,Â <font color="#d7875f">0x5A</font>,Â <font color="#d7875f">0x4A</font>,<br/>
<font color="#d7875f">0x5A</font>,Â <font color="#d7875f">0x40</font>,Â <font color="#d7875f">0x5B</font>,Â <font color="#d7875f">0x5A</font>,Â <font color="#d7875f">0x5A</font>,Â <font color="#d7875f">0x34</font>,Â <font color="#d7875f">0x7A</font>,Â <font color="#d7875f">0x7F</font>,Â <font color="#d7875f">0x5A</font>,<br/>
<font color="#d7875f">0x4A</font>,Â <font color="#d7875f">0x5A</font>,Â <font color="#d7875f">0x50</font>,Â <font color="#d7875f">0x5A</font>,Â <font color="#d7875f">0x63</font>,Â <font color="#d7875f">0x5A</font>,Â <font color="#d7875f">0x47</font>,Â <font color="#d7875f">0x5A</font>,Â <font color="#d7875f">0xE</font>Â ,<br/>
<font color="#d7875f">0xA</font>,Â <font color="#d7875f">0x58</font>,Â <font color="#d7875f">0x5A</font>,Â <font color="#d7875f">0x34</font>,Â <font color="#d7875f">0x4A</font>,Â <font color="#d7875f">0x5B</font>,Â <font color="#d7875f">0x5A</font>,Â <font color="#d7875f">0x5A</font>,Â <font color="#d7875f">0x5A</font>Â ,<br/>
<font color="#d7875f">0x56</font>,Â <font color="#d7875f">0x5A</font>,Â <font color="#d7875f">0x78</font>,Â <font color="#d7875f">0x5B</font>,Â <font color="#d7875f">0x45</font>,Â <font color="#d7875f">0x5A</font>,Â <font color="#d7875f">0x38</font>,Â <font color="#d7875f">0x58</font>,Â <font color="#d7875f">0x5E</font>,<br/>
<font color="#d7875f">0x5A</font>,Â <font color="#d7875f">0xE</font>,Â <font color="#d7875f">9</font>,Â <font color="#d7875f">0x5F</font>,Â <font color="#d7875f">0x5A</font>,Â <font color="#d7875f">0x2B</font>,Â <font color="#d7875f">0x7A</font>,Â <font color="#d7875f">0x78</font>,Â <font color="#d7875f">0x5A</font>,Â <font color="#d7875f">0x68</font>,<br/>
<font color="#d7875f">0x5A</font>,Â <font color="#d7875f">0x56</font>,Â <font color="#d7875f">0x58</font>,Â <font color="#d7875f">0x2A</font>,Â <font color="#d7875f">0x7A</font>,Â <font color="#d7875f">0x7E</font>,Â <font color="#d7875f">0x5A</font>,Â <font color="#d7875f">0x7B</font>,Â <font color="#d7875f">0x5A</font>,<br/>
<font color="#d7875f">0x48</font>,Â <font color="#d7875f">0x48</font>,Â <font color="#d7875f">0x2B</font>,Â <font color="#d7875f">0x6A</font>,Â <font color="#d7875f">0x4F</font>,Â <font color="#d7875f">0x5A</font>,Â <font color="#d7875f">0x4A</font>,Â <font color="#d7875f">0x58</font>,Â <font color="#d7875f">0x56</font>,<br/>
<font color="#d7875f">0x5A</font>,Â <font color="#d7875f">0x34</font>,Â <font color="#d7875f">0x4A</font>,Â <font color="#d7875f">0x4C</font>,Â <font color="#d7875f">0x5A</font>,Â <font color="#d7875f">0x5A</font>,Â <font color="#d7875f">0x5A</font>,Â <font color="#d7875f">0x54</font>,Â <font color="#d7875f">0x5A</font>,<br/>
<font color="#d7875f">0x5A</font>,Â <font color="#d7875f">0x59</font>,Â <font color="#d7875f">0x5B</font>,Â <font color="#d7875f">0x5A</font>,Â <font color="#d7875f">0x52</font>,Â <font color="#d7875f">0x5A</font>,Â <font color="#d7875f">0x5A</font>,Â <font color="#d7875f">0x5A</font>,Â <font color="#d7875f">0x40</font>,<br/>
<font color="#d7875f">0x41</font>,Â <font color="#d7875f">0x44</font>,Â <font color="#d7875f">0x5E</font>,Â <font color="#d7875f">0x4F</font>,Â <font color="#d7875f">0x58</font>,Â <font color="#d7875f">0x48</font>,Â <font color="#d7875f">0x5D</font><br/>
]<br/>
<font color="#ffd75f">for</font>Â iÂ <font color="#ffd75f">in</font>Â <font color="#878787">range</font>(<font color="#878787">len</font>(data)):<br/>
Â Â Â Â patched_ddex[<font color="#d7875f">0x720</font>Â + i] = data[i] ^Â <font color="#d7875f">0x5A</font>;<br/>
<font color="#ffd75f">with</font>Â <font color="#878787">open</font>(<font color="#afaf87"><i>"</i></font><font color="#afaf87"><i>./patached_ddex.dex</i></font><font color="#afaf87"><i>"</i></font>,Â <font color="#afaf87"><i>"</i></font><font color="#afaf87"><i>wb</i></font><font color="#afaf87"><i>"</i></font>)Â <font color="#ffd75f">as</font>Â _:<br/>
Â Â Â Â _.write(patched_ddex)<br/>
</font>
</pre>

<p>
ä¸Šè¿°ä»£ç é‡Œé¢ç¬¬ä¸€ä¸ª with è¯­å¥ç”¨äºåˆæ­¥å°† dex æ–‡ä»¶è¯»å–å‡ºæ¥,
data æ˜¯ä» 0x2E88 å¤„å–å‡ºæ¥çš„ 0x90 ä¸ªå­—èŠ‚.
æœ€åæ¨¡æ‹Ÿæ‰§è¡Œå¼‚æˆ–è¿ç®—å³å¯,ç”Ÿæˆçš„ patched_ddex.dex å³ä¸ºæœ€ç»ˆ dex æ–‡ä»¶.
</p>

<p>
ä½¿ç”¨ jadx åç¼–è¯‘è¯¥ dex æ–‡ä»¶,æˆ‘ä»¬å¾—åˆ°å¦‚ä¸‹æ–‡ä»¶ç›®å½•
<img src="./images/dexstruct.png" alt="">
ä¸»è¦æ˜¯å››ä¸ª java æ–‡ä»¶. çœ‹ä¸€ä¸‹å„ä¸ªæ–‡ä»¶æ˜¯ä»€ä¹ˆä½œç”¨.
</p>

<h2 class="subtitle">S.java æ–‡ä»¶</h2>
<pre style="background-color:#272822;color:#d0d0d0;padding:1%;border-radius:20px;line-height:10px;">
<font face="monospace">
<font color="#87af5f">public</font>Â <font color="#87af5f">class</font>Â S {<br/>
Â Â Â Â <font color="#87af5f">public</font>Â <font color="#87af5f">static</font>Â String I =Â <font color="#afaf87"><i>"FLAG_FACTORY"</i></font>;<br/>
Â Â Â Â <font color="#87af5f">public</font>Â <font color="#87af5f">static</font>Â Activity a;<br/>
<br/>
Â Â Â Â <font color="#87af5f">public</font>Â S(<font color="#87af5f">final</font>Â Activity activity)Â {<br/>
Â Â Â Â Â Â Â Â <font color="#87af5f">int</font>Â i =Â <font color="#d7875f">0</font>;<br/>
Â Â Â Â Â Â Â Â a = activity;<br/>
Â Â Â Â Â Â Â Â Context applicationContext = activity.getApplicationContext();<br/>
Â Â Â Â Â Â Â Â GridLayout gridLayout =Â (GridLayout)Â activity.findViewById(R.id.foodLayout);<br/>
Â Â Â Â Â Â Â Â String[]Â strArr =Â <font color="#ffd75f">new</font>Â String[]{<font color="#afaf87"><i>"ğŸ•"</i></font>,Â <font color="#afaf87"><i>"ğŸ¬"</i></font>,Â <font color="#afaf87"><i>"ğŸ"</i></font>,Â <font color="#afaf87"><i>"ğŸ"</i></font>,Â <font color="#afaf87"><i>"ğŸ…"</i></font>,Â <font color="#afaf87"><i>"ğŸ™"</i></font>,Â <font color="#afaf87"><i>"ğŸ"</i></font>,<br/>
Â Â Â Â Â Â Â Â Â Â Â Â <font color="#afaf87"><i>"ğŸ“"</i></font>,Â <font color="#afaf87"><i>"ğŸˆ"</i></font>,Â <font color="#afaf87"><i>"ğŸ‰"</i></font>,Â <font color="#afaf87"><i>"ğŸŒ°"</i></font>,Â <font color="#afaf87"><i>"ğŸ—"</i></font>,Â <font color="#afaf87"><i>"ğŸ¤"</i></font>,Â <font color="#afaf87"><i>"ğŸ¦"</i></font>,Â <font color="#afaf87"><i>"ğŸ‡"</i></font>,Â <font color="#afaf87"><i>"ğŸŒ"</i></font>,Â <font color="#afaf87"><i>"ğŸ£"</i></font>,Â <font color="#afaf87"><i>"ğŸ„"</i></font>,Â <font color="#afaf87"><i>"</i></font><br/>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ğŸŠ<font color="#afaf87"><i>", "</i></font>ğŸ’<font color="#afaf87"><i>", "</i></font>ğŸ <font color="#afaf87"><i>", "</i></font>ğŸ<font color="#afaf87"><i>", "</i></font>ğŸ†<font color="#afaf87"><i>", "</i></font>ğŸŸ<font color="#afaf87"><i>", "</i></font>ğŸ”<font color="#afaf87"><i>", "</i></font>ğŸœ<font color="#afaf87"><i>", "</i></font>ğŸ©<font color="#afaf87"><i>", "</i></font>ğŸš<font color="#afaf87"><i>", "</i></font>ğŸ¨<font color="#afaf87"><i>",</i></font><br/>
Â Â Â Â Â Â Â Â Â Â Â Â <font color="#afaf87"><i>"ğŸŒ¾"</i></font>,Â <font color="#afaf87"><i>"ğŸŒ½"</i></font>,Â <font color="#afaf87"><i>"ğŸ–"</i></font>};<br/>
Â Â Â Â Â Â Â Â <font color="#ffd75f">while</font>Â (i &lt;Â <font color="#d7875f">32</font>)Â {<br/>
Â Â Â Â Â Â Â Â Â Â Â Â View button =Â <font color="#ffd75f">new</font>Â Button(applicationContext);<br/>
Â Â Â Â Â Â Â Â Â Â Â Â LayoutParams layoutParams =Â <font color="#ffd75f">new</font>Â GridLayout.LayoutParams();<br/>
Â Â Â Â Â Â Â Â Â Â Â Â layoutParams.width =Â (<font color="#87af5f">int</font>)Â TypedValue.applyDimension(<font color="#d7875f">1</font>,Â <font color="#d7875f">60.0f</font>, activity.getResources().getDisplayMetrics());<br/>
Â Â Â Â Â Â Â Â Â Â Â Â layoutParams.height =Â (<font color="#87af5f">int</font>)Â TypedValue.applyDimension(<font color="#d7875f">1</font>,Â <font color="#d7875f">60.0f</font>, activity.getResources().getDisplayMetrics());<br/>
Â Â Â Â Â Â Â Â Â Â Â Â button.setLayoutParams(layoutParams);<br/>
Â Â Â Â Â Â Â Â Â Â Â Â button.setText(strArr[i]);<br/>
Â Â Â Â Â Â Â Â Â Â Â Â button.setOnClickListener(<font color="#ffd75f">new</font>Â OnClickListener()Â {<br/>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <font color="#87af5f">public</font>Â <font color="#87af5f">void</font>Â onClick(View view)Â {<br/>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â view.playSoundEffect(<font color="#d7875f">0</font>);<br/>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Intent intent =Â <font color="#ffd75f">new</font>Â Intent(S.I);<br/>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â intent.putExtra(<font color="#afaf87"><i>"id"</i></font>, i);<br/>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â activity.sendBroadcast(intent);<br/>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }<br/>
Â Â Â Â Â Â Â Â Â Â Â Â });<br/>
Â Â Â Â Â Â Â Â Â Â Â Â gridLayout.addView(button);<br/>
Â Â Â Â Â Â Â Â Â Â Â Â i++;<br/>
Â Â Â Â Â Â Â Â }<br/>
Â Â Â Â Â Â Â Â IntentFilter intentFilter =Â <font color="#ffd75f">new</font>Â IntentFilter();<br/>
Â Â Â Â Â Â Â Â intentFilter.addAction(I);<br/>
Â Â Â Â Â Â Â Â activity.registerReceiver(<font color="#ffd75f">new</font>Â F(activity), intentFilter);<br/>
Â Â Â Â }<br/>
}<br/>
</font>
</pre>
<p>
è®¾ç½®äº† 32 ä¸­é£Ÿå“,ç»™æ²¡è¿™ä¸ªé£Ÿå“æ·»åŠ äº†ä¸€ä¸ªäº‹ä»¶ç›‘å¬å™¨,æ¯ä¸ªé£Ÿå“æœ‰ä¸€ä¸ªé£Ÿå“ id,
æœ€ç»ˆè¯¥ id å°†ä¼šé€šè¿‡ intent å‘é€åˆ° F.java æ–‡ä»¶å¤„ç†, æˆ‘ä»¬çœ‹çœ‹ F.java æ–‡ä»¶.
</p>

<h2 class="subtitle">F.java</h2>
<pre style="background-color:#272822;color:#d0d0d0;padding:1%;border-radius:20px;line-height:10px;">
<font face="monospace">
<font color="#87af5f">public</font>Â <font color="#87af5f">class</font>Â FÂ <font color="#87af5f">extends</font>Â BroadcastReceiver {<br/>
Â Â Â Â <font color="#87af5f">private</font>Â <font color="#87af5f">static</font>Â <font color="#87af5f">byte</font>[]Â flag =Â <font color="#ffd75f">new</font>Â <font color="#87af5f">byte</font>[]{(<font color="#87af5f">byte</font>)Â -<font color="#d7875f">19</font>,Â (<font color="#87af5f">byte</font>)Â <font color="#d7875f">116</font>,Â (<font color="#87af5f">byte</font>)Â <font color="#d7875f">58</font>,<br/>
Â Â Â Â Â Â Â Â (<font color="#87af5f">byte</font>)Â <font color="#d7875f">108</font>,Â (<font color="#87af5f">byte</font>)Â -<font color="#d7875f">1</font>,Â (<font color="#87af5f">byte</font>)Â <font color="#d7875f">33</font>,Â (<font color="#87af5f">byte</font>)Â <font color="#d7875f">9</font>,Â (<font color="#87af5f">byte</font>)Â <font color="#d7875f">61</font>,Â (<font color="#87af5f">byte</font>)Â -<font color="#d7875f">61</font>,<br/>
Â Â Â Â Â Â Â Â (<font color="#87af5f">byte</font>)Â -<font color="#d7875f">37</font>,Â (<font color="#87af5f">byte</font>)Â <font color="#d7875f">108</font>,Â (<font color="#87af5f">byte</font>)Â -<font color="#d7875f">123</font>,Â (<font color="#87af5f">byte</font>)Â <font color="#d7875f">3</font>,Â (<font color="#87af5f">byte</font>)Â <font color="#d7875f">35</font>,Â (<font color="#87af5f">byte</font>)Â <font color="#d7875f">97</font>,<br/>
Â Â Â Â Â Â Â Â (<font color="#87af5f">byte</font>)Â -<font color="#d7875f">10</font>,Â (<font color="#87af5f">byte</font>)Â -<font color="#d7875f">15</font>,Â (<font color="#87af5f">byte</font>)Â <font color="#d7875f">15</font>,Â (<font color="#87af5f">byte</font>)Â -<font color="#d7875f">85</font>,Â (<font color="#87af5f">byte</font>)Â -<font color="#d7875f">66</font>,Â (<font color="#87af5f">byte</font>)Â -<font color="#d7875f">31</font>,<br/>
Â Â Â Â Â Â Â Â (<font color="#87af5f">byte</font>)Â -<font color="#d7875f">65</font>,Â (<font color="#87af5f">byte</font>)Â <font color="#d7875f">17</font>,Â (<font color="#87af5f">byte</font>)Â <font color="#d7875f">79</font>,Â (<font color="#87af5f">byte</font>)Â <font color="#d7875f">31</font>,Â (<font color="#87af5f">byte</font>)Â <font color="#d7875f">25</font>,Â (<font color="#87af5f">byte</font>)Â -<font color="#d7875f">39</font>,<br/>
Â Â Â Â Â Â Â Â (<font color="#87af5f">byte</font>)Â <font color="#d7875f">95</font>,Â (<font color="#87af5f">byte</font>)Â <font color="#d7875f">93</font>,Â (<font color="#87af5f">byte</font>)Â <font color="#d7875f">1</font>,Â (<font color="#87af5f">byte</font>)Â -<font color="#d7875f">110</font>,Â (<font color="#87af5f">byte</font>)Â -<font color="#d7875f">103</font>,Â (<font color="#87af5f">byte</font>)Â -<font color="#d7875f">118</font>,<br/>
Â Â Â Â Â Â Â Â (<font color="#87af5f">byte</font>)Â -<font color="#d7875f">38</font>,Â (<font color="#87af5f">byte</font>)Â -<font color="#d7875f">57</font>,Â (<font color="#87af5f">byte</font>)Â -<font color="#d7875f">58</font>,Â (<font color="#87af5f">byte</font>)Â -<font color="#d7875f">51</font>,Â (<font color="#87af5f">byte</font>)Â -<font color="#d7875f">79</font>};<br/>
Â Â Â Â <font color="#87af5f">private</font>Â Activity a;<br/>
Â Â Â Â <font color="#87af5f">private</font>Â <font color="#87af5f">int</font>Â c;<br/>
Â Â Â Â <font color="#87af5f">private</font>Â <font color="#87af5f">byte</font>[]Â k =Â <font color="#ffd75f">new</font>Â <font color="#87af5f">byte</font>[<font color="#d7875f">8</font>];<br/>
<br/>
Â Â Â Â <font color="#87af5f">public</font>Â F(Activity activity)Â {<br/>
Â Â Â Â Â Â Â Â <font color="#87af5f">this</font>.a = activity;<br/>
Â Â Â Â Â Â Â Â <font color="#ffd75f">for</font>Â (<font color="#87af5f">int</font>Â i =Â <font color="#d7875f">0</font>; i &lt;Â <font color="#d7875f">8</font>; i++)Â {<br/>
Â Â Â Â Â Â Â Â Â Â Â Â <font color="#87af5f">this</font>.k[i]Â =Â (<font color="#87af5f">byte</font>)Â <font color="#d7875f">0</font>;<br/>
Â Â Â Â Â Â Â Â }<br/>
Â Â Â Â Â Â Â Â <font color="#87af5f">this</font>.c =Â <font color="#d7875f">0</font>;<br/>
Â Â Â Â }<br/>
<br/>
Â Â Â Â <font color="#87af5f">public</font>Â <font color="#87af5f">void</font>Â onReceive(Context context, Intent intent)Â {<br/>
Â Â Â Â Â Â Â Â <font color="#87af5f">this</font>.k[<font color="#87af5f">this</font>.c]Â =Â (<font color="#87af5f">byte</font>)Â intent.getExtras().getInt(<font color="#afaf87"><i>"id"</i></font>);<br/>
Â Â Â Â Â Â Â Â cc();<br/>
Â Â Â Â Â Â Â Â <font color="#87af5f">this</font>.c++;<br/>
Â Â Â Â Â Â Â Â <font color="#ffd75f">if</font>Â (<font color="#87af5f">this</font>.c ==Â <font color="#d7875f">8</font>)Â {<br/>
Â Â Â Â Â Â Â Â Â Â Â Â <font color="#87af5f">this</font>.c =Â <font color="#d7875f">0</font>;<br/>
Â Â Â Â Â Â Â Â Â Â Â Â <font color="#87af5f">this</font>.k =Â <font color="#ffd75f">new</font>Â <font color="#87af5f">byte</font>[<font color="#d7875f">8</font>];<br/>
Â Â Â Â Â Â Â Â Â Â Â Â <font color="#ffd75f">for</font>Â (<font color="#87af5f">int</font>Â i =Â <font color="#d7875f">0</font>; i &lt;Â <font color="#d7875f">8</font>; i++)Â {<br/>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <font color="#87af5f">this</font>.k[i]Â =Â (<font color="#87af5f">byte</font>)Â <font color="#d7875f">0</font>;<br/>
Â Â Â Â Â Â Â Â Â Â Â Â }<br/>
Â Â Â Â Â Â Â Â }<br/>
Â Â Â Â }<br/>
<br/>
Â Â Â Â <font color="#87af5f">public</font>Â <font color="#87af5f">void</font>Â cc()Â {<br/>
Â Â Â Â Â Â Â Â <font color="#87af5f">byte</font>[]Â bArr =Â <font color="#ffd75f">new</font>Â <font color="#87af5f">byte</font>[]{(<font color="#87af5f">byte</font>)Â <font color="#d7875f">26</font>,Â (<font color="#87af5f">byte</font>)Â <font color="#d7875f">27</font>,Â (<font color="#87af5f">byte</font>)Â <font color="#d7875f">30</font>,Â (<font color="#87af5f">byte</font>)Â <font color="#d7875f">4</font>,Â (<font color="#87af5f">byte</font>)Â <font color="#d7875f">21</font>,Â (<font color="#87af5f">byte</font>)Â <font color="#d7875f">2</font>,Â (<font color="#87af5f">byte</font>)Â <font color="#d7875f">18</font>,Â (<font color="#87af5f">byte</font>)Â <font color="#d7875f">7</font>};<br/>
Â Â Â Â Â Â Â Â <font color="#ffd75f">for</font>Â (<font color="#87af5f">int</font>Â i =Â <font color="#d7875f">0</font>; i &lt;Â <font color="#d7875f">8</font>; i++)Â {<br/>
Â Â Â Â Â Â Â Â Â Â Â Â bArr[i]Â =Â (<font color="#87af5f">byte</font>)Â (bArr[i]Â ^Â <font color="#87af5f">this</font>.k[i]);<br/>
Â Â Â Â Â Â Â Â }<br/>
Â Â Â Â Â Â Â Â <font color="#ffd75f">if</font>Â (<font color="#ffd75f">new</font>Â String(bArr).compareTo(<font color="#afaf87"><i>"</i></font><font color="#ff5f5f">\u0013\u0011\u0013\u0003\u0004\u0003\u0001\u0005</font><font color="#afaf87"><i>"</i></font>)Â ==Â <font color="#d7875f">0</font>)Â {<br/>
Â Â Â Â Â Â Â Â Â Â Â Â Toast.makeText(<font color="#87af5f">this</font>.a.getApplicationContext(),Â <font color="#ffd75f">new</font>Â String(â„.â„‚(flag,Â <font color="#87af5f">this</font>.k)),Â <font color="#d7875f">1</font>).show();<br/>
Â Â Â Â Â Â Â Â }<br/>
Â Â Â Â }<br/>
}<br/>
</font>
</pre>

<p>
ä»¿ä½›çœ‹åˆ°äº† flag, F æ˜¯åœ¨ onReceive ä¸­æ”¶åˆ°æ¥è‡ª intent çš„æ¶ˆæ¯çš„,å¯ä»¥çœ‹åˆ°,
æ”¶åˆ°æ¶ˆæ¯åå¯¹ç§æœ‰æˆå‘˜å˜é‡ k è®¾ç½®äº†å¯¹åº”çš„é£Ÿç‰© id, ç„¶åè°ƒç”¨ cc() å‡½æ•°,
çœ‹åˆ° cc å‡½æ•°é‡Œé¢çš„ if è¯­å¥, å¦‚æœæ¯”è¾ƒæˆåŠŸ, åˆ™è°ƒç”¨ R.java ä¸­çš„æ–¹æ³•æ‰“å° flag,
æˆ‘ä»¬çœ‹åˆ° cc å‡½æ•°å®é™…ä¸Šå°±æ˜¯æ‰§è¡Œäº†å¼‚æˆ–æ“ä½œ,è¿™äº›æ“ä½œæ˜¯å¯é€†çš„,
æ‰€ä»¥æˆ‘ä»¬çŸ¥é“ bArr å’Œ k è¿›è¡Œå¼‚æˆ–æ“ä½œåå¾—åˆ°çš„å­—èŠ‚æ•°ç»„çš„å­—ç¬¦ä¸²å½¢å¼å³ä¸º
"\u0013\u0011\u0013\u0003\u0004\u0003\u0001\u0005" ,
é‚£ä¹ˆæˆ‘ä»¬å¾—åˆ°è¯¥å­—ç¬¦ä¸²çš„å­—èŠ‚æ•°ç»„,å†ä¸ bArr è¿›è¡ŒåŒæ ·çš„å¼‚æˆ–æ“ä½œ,
æˆ‘ä»¬ä¾¿å¯ä»¥å¾—åˆ° k çš„å€¼,ä¹Ÿå°±æ˜¯æ­£ç¡®çš„é£Ÿç‰© id åºåˆ—, å°†è¯¥åºåˆ—å¸¦å…¥ R.C å‡½æ•°å³å¯åå‘å¾—åˆ° flag.
æˆ‘æŠŠ R.C å‡½æ•°æå–å‡ºæ¥,ç„¶åå•ç‹¬å†™æˆä¸€ä¸ª java æ–‡ä»¶(solve.java) å¦‚ä¸‹:
</p>

<pre style="background-color:#272822;color:#d0d0d0;padding:1%;border-radius:20px;line-height:10px;">
<font face="monospace">
<font color="#875f87"><i>/*</i></font><br/>
<font color="#875f87"><i>Â * makefile</i></font><br/>
<font color="#875f87"><i>all:</i></font><br/>
<font color="#875f87"><i>Â Â Â Â @javac solve.java</i></font><br/>
<font color="#875f87"><i>Â Â Â Â @java solve</i></font><br/>
<font color="#875f87"><i>*/</i></font><br/>
<font color="#87af5f">public</font>Â <font color="#87af5f">class</font>Â solve {<br/>
Â Â Â Â <font color="#87af5f">public</font>Â <font color="#87af5f">static</font>Â <font color="#87af5f">byte</font>[]Â C(<font color="#87af5f">byte</font>[]Â bArr,Â <font color="#87af5f">byte</font>[]Â bArr2)Â {<br/>
Â Â Â Â Â Â Â Â <font color="#87af5f">byte</font>[]Â bArr3 =Â <font color="#ffd75f">new</font>Â <font color="#87af5f">byte</font>[<font color="#d7875f">256</font>];<br/>
Â Â Â Â Â Â Â Â <font color="#87af5f">byte</font>[]Â bArr4 =Â <font color="#ffd75f">new</font>Â <font color="#87af5f">byte</font>[<font color="#d7875f">256</font>];<br/>
Â Â Â Â Â Â Â Â <font color="#87af5f">int</font>Â i =Â <font color="#d7875f">0</font>;<br/>
Â Â Â Â Â Â Â Â <font color="#87af5f">int</font>Â i2 =Â <font color="#d7875f">0</font>;<br/>
Â Â Â Â Â Â Â Â <font color="#ffd75f">while</font>Â (i2 !=Â <font color="#d7875f">256</font>)Â {<br/>
Â Â Â Â Â Â Â Â Â Â Â Â bArr3[i2]Â =Â (<font color="#87af5f">byte</font>)Â i2;<br/>
Â Â Â Â Â Â Â Â Â Â Â Â bArr4[i2]Â = bArr2[i2 % bArr2.length];<br/>
Â Â Â Â Â Â Â Â Â Â Â Â i2++;<br/>
Â Â Â Â Â Â Â Â }<br/>
Â Â Â Â Â Â Â Â <font color="#87af5f">int</font>Â i3 = i2 ^ i2;<br/>
Â Â Â Â Â Â Â Â i2 =Â <font color="#d7875f">0</font>;<br/>
Â Â Â Â Â Â Â Â <font color="#ffd75f">while</font>Â (i3 !=Â <font color="#d7875f">256</font>)Â {<br/>
Â Â Â Â Â Â Â Â Â Â Â Â i2 =Â ((i2 + bArr3[i3])Â + bArr4[i3])Â &amp;Â <font color="#d7875f">255</font>;<br/>
Â Â Â Â Â Â Â Â Â Â Â Â bArr3[i2]Â =Â (<font color="#87af5f">byte</font>)Â (bArr3[i2]Â ^ bArr3[i3]);<br/>
Â Â Â Â Â Â Â Â Â Â Â Â bArr3[i3]Â =Â (<font color="#87af5f">byte</font>)Â (bArr3[i3]Â ^ bArr3[i2]);<br/>
Â Â Â Â Â Â Â Â Â Â Â Â bArr3[i2]Â =Â (<font color="#87af5f">byte</font>)Â (bArr3[i2]Â ^ bArr3[i3]);<br/>
Â Â Â Â Â Â Â Â Â Â Â Â i3++;<br/>
Â Â Â Â Â Â Â Â }<br/>
Â Â Â Â Â Â Â Â bArr4 =Â <font color="#ffd75f">new</font>Â <font color="#87af5f">byte</font>[bArr.length];<br/>
Â Â Â Â Â Â Â Â i3 ^= i3;<br/>
Â Â Â Â Â Â Â Â i2 ^= i2;<br/>
Â Â Â Â Â Â Â Â <font color="#ffd75f">while</font>Â (i != bArr.length)Â {<br/>
Â Â Â Â Â Â Â Â Â Â Â Â i3 =Â (i3 +Â <font color="#d7875f">1</font>)Â &amp;Â <font color="#d7875f">255</font>;<br/>
Â Â Â Â Â Â Â Â Â Â Â Â i2 =Â (i2 + bArr3[i3])Â &amp;Â <font color="#d7875f">255</font>;<br/>
Â Â Â Â Â Â Â Â Â Â Â Â bArr3[i2]Â =Â (<font color="#87af5f">byte</font>)Â (bArr3[i2]Â ^ bArr3[i3]);<br/>
Â Â Â Â Â Â Â Â Â Â Â Â bArr3[i3]Â =Â (<font color="#87af5f">byte</font>)Â (bArr3[i3]Â ^ bArr3[i2]);<br/>
Â Â Â Â Â Â Â Â Â Â Â Â bArr3[i2]Â =Â (<font color="#87af5f">byte</font>)Â (bArr3[i2]Â ^ bArr3[i3]);<br/>
Â Â Â Â Â Â Â Â Â Â Â Â bArr4[i]Â =Â (<font color="#87af5f">byte</font>)Â (bArr[i]Â ^ bArr3[(bArr3[i3]Â + bArr3[i2])Â &amp;Â <font color="#d7875f">255</font>]);<br/>
Â Â Â Â Â Â Â Â Â Â Â Â i++;<br/>
Â Â Â Â Â Â Â Â }<br/>
Â Â Â Â Â Â Â Â <font color="#ffd75f">return</font>Â bArr4;<br/>
Â Â Â Â }<br/>
<br/>
Â Â Â Â <font color="#87af5f">private</font>Â <font color="#87af5f">static</font>Â <font color="#87af5f">byte</font>[]Â flag =Â <font color="#ffd75f">new</font>Â <font color="#87af5f">byte</font>[]{(<font color="#87af5f">byte</font>)Â -<font color="#d7875f">19</font>,Â (<font color="#87af5f">byte</font>)Â <font color="#d7875f">116</font>,Â (<font color="#87af5f">byte</font>)Â <font color="#d7875f">58</font>,<br/>
Â Â Â Â Â Â Â Â (<font color="#87af5f">byte</font>)Â <font color="#d7875f">108</font>,Â (<font color="#87af5f">byte</font>)Â -<font color="#d7875f">1</font>,Â (<font color="#87af5f">byte</font>)Â <font color="#d7875f">33</font>,Â (<font color="#87af5f">byte</font>)Â <font color="#d7875f">9</font>,Â (<font color="#87af5f">byte</font>)Â <font color="#d7875f">61</font>,Â (<font color="#87af5f">byte</font>)Â -<font color="#d7875f">61</font>,<br/>
Â Â Â Â Â Â Â Â (<font color="#87af5f">byte</font>)Â -<font color="#d7875f">37</font>,Â (<font color="#87af5f">byte</font>)Â <font color="#d7875f">108</font>,Â (<font color="#87af5f">byte</font>)Â -<font color="#d7875f">123</font>,Â (<font color="#87af5f">byte</font>)Â <font color="#d7875f">3</font>,Â (<font color="#87af5f">byte</font>)Â <font color="#d7875f">35</font>,Â (<font color="#87af5f">byte</font>)Â <font color="#d7875f">97</font>,<br/>
Â Â Â Â Â Â Â Â (<font color="#87af5f">byte</font>)Â -<font color="#d7875f">10</font>,Â (<font color="#87af5f">byte</font>)Â -<font color="#d7875f">15</font>,Â (<font color="#87af5f">byte</font>)Â <font color="#d7875f">15</font>,Â (<font color="#87af5f">byte</font>)Â -<font color="#d7875f">85</font>,Â (<font color="#87af5f">byte</font>)Â -<font color="#d7875f">66</font>,Â (<font color="#87af5f">byte</font>)Â -<font color="#d7875f">31</font>,<br/>
Â Â Â Â Â Â Â Â (<font color="#87af5f">byte</font>)Â -<font color="#d7875f">65</font>,Â (<font color="#87af5f">byte</font>)Â <font color="#d7875f">17</font>,Â (<font color="#87af5f">byte</font>)Â <font color="#d7875f">79</font>,Â (<font color="#87af5f">byte</font>)Â <font color="#d7875f">31</font>,Â (<font color="#87af5f">byte</font>)Â <font color="#d7875f">25</font>,Â (<font color="#87af5f">byte</font>)Â -<font color="#d7875f">39</font>,<br/>
Â Â Â Â Â Â Â Â (<font color="#87af5f">byte</font>)Â <font color="#d7875f">95</font>,Â (<font color="#87af5f">byte</font>)Â <font color="#d7875f">93</font>,Â (<font color="#87af5f">byte</font>)Â <font color="#d7875f">1</font>,Â (<font color="#87af5f">byte</font>)Â -<font color="#d7875f">110</font>,Â (<font color="#87af5f">byte</font>)Â -<font color="#d7875f">103</font>,Â (<font color="#87af5f">byte</font>)Â -<font color="#d7875f">118</font>,<br/>
Â Â Â Â Â Â Â Â (<font color="#87af5f">byte</font>)Â -<font color="#d7875f">38</font>,Â (<font color="#87af5f">byte</font>)Â -<font color="#d7875f">57</font>,Â (<font color="#87af5f">byte</font>)Â -<font color="#d7875f">58</font>,Â (<font color="#87af5f">byte</font>)Â -<font color="#d7875f">51</font>,Â (<font color="#87af5f">byte</font>)Â -<font color="#d7875f">79</font>};<br/>
<br/>
Â Â Â Â <font color="#87af5f">public</font>Â <font color="#87af5f">static</font>Â <font color="#87af5f">void</font>Â main(StringÂ []args)Â {<br/>
Â Â Â Â Â Â Â Â <font color="#87af5f">byte</font>[]Â k =Â <font color="#afaf87"><i>"</i></font><font color="#ff5f5f">\u0013\u0011\u0013\u0003\u0004\u0003\u0001\u0005</font><font color="#afaf87"><i>"</i></font>.getBytes();<br/>
Â Â Â Â Â Â Â Â <font color="#875f87"><i>//System.out.println(k.length);</i></font><br/>
Â Â Â Â Â Â Â Â <font color="#87af5f">byte</font>[]Â bArr =Â <font color="#ffd75f">new</font>Â <font color="#87af5f">byte</font>[]{(<font color="#87af5f">byte</font>)Â <font color="#d7875f">26</font>,Â (<font color="#87af5f">byte</font>)Â <font color="#d7875f">27</font>,Â (<font color="#87af5f">byte</font>)Â <font color="#d7875f">30</font>,Â (<font color="#87af5f">byte</font>)Â <font color="#d7875f">4</font>,Â (<font color="#87af5f">byte</font>)Â <font color="#d7875f">21</font>,Â (<font color="#87af5f">byte</font>)Â <font color="#d7875f">2</font>,Â (<font color="#87af5f">byte</font>)Â <font color="#d7875f">18</font>,Â (<font color="#87af5f">byte</font>)Â <font color="#d7875f">7</font>};<br/>
Â Â Â Â Â Â Â Â <font color="#ffd75f">for</font>Â (<font color="#87af5f">int</font>Â i =Â <font color="#d7875f">0</font>; i &lt;Â <font color="#d7875f">8</font>; i++)Â {<br/>
Â Â Â Â Â Â Â Â Â Â Â Â bArr[i]Â =Â (<font color="#87af5f">byte</font>)Â (bArr[i]Â ^ k[i]);<br/>
Â Â Â Â Â Â Â Â Â Â Â Â <font color="#875f87"><i>//System.out.println(k[i]);</i></font><br/>
Â Â Â Â Â Â Â Â }<br/>
Â Â Â Â Â Â Â Â System.out.println(<font color="#ffd75f">new</font>Â String(C(flag,bArr)));<br/>
Â Â Â Â }<br/>
}<br/>
</font>
</pre>

<p>
è¿è¡Œåå³å¯å¾—åˆ° flag ä¸º <b class="term">CTF{bacon_lettuce_tomato_lobster_soul}</b>.
</p>

<!--
# å°ä¼™å­,ä¸é”™å“¦ ~
#! /usr/bin/env python3
#! -*- coding:utf-8 -*-

def solve(lst):
    result = []
    for numstr in lst:
        num = int(numstr)
        chaint = ~((~num | ((num & 0xFF00) >> 8)) & (~((num & 0xFF00) >> 8) | num))
        cha = chaint & 0xff
        chbint = ((num & 0xFF000000) >> 24) ^ ((num & 0xFF0000) >> 16)
        chb = chbint & 0xff
        result.append(chr(cha))
        result.append(chr(chb))
    rst = ''.join(result)
    print(rst)
    return rst

solve([ 625020704, 274990436, 1534345504, 73731176, 107435040, 208625010, 57547381, 1193298532, 174394722, 174457445, 1331774752, 274992494, 1298351648, 7276911, 1142948971, 141449845, 90774900, 1394608492, 376589666, 326582639, 493161326 ] )
solve([ 1244547940, 927154464, 1517622130, 56756589, 73734252, 208604960, 140843382, 1193303154, 7277922, 90772085, 1114376556, 443419759, 1298351648, 224531317, 393415269, 1176503084, 40765537, 1394606436, 460610675, 393350505, 1768511520 ] )
solve([ 1142964590, 493426295, 1248137070, 1092640571, 242161507, 393494894, 57542249, 40196981, 460607264, 1277167727, 1097795171, 527109231, 1214662176, 494012783, 90263328, 6688544, 460786789, 510477600, 24004201, 292819317, 1551048037, 236997166, 292829011, 1920078185 ] )
solve([ 107561760, 253756270, 124257379, 393216111, 6626416, 1126189924, 158269556, 123814509, 7281524, 1551040869, 539000620 ] )
solve([ 140577639, 141299826, 241377129, 1394606636, 1852706401 ] )
solve([ 1327499108, 1081022836, 241240685, 141499252, 359681056, 275992161, 56950900, 1176502574, 174406739, 1551041889, 23996783, 326586144, 393488489, 1226841192, 140576368, 192021616 ] )
solve([158015081])
solve([1294730593, 358829088, 40436072, 443106156, 57694496, 309795695, 1248135524, 1227634290, 543381536, 410586465, 493753957, 174400110, 342901024, 40894565 ])
solve([ 207965296, 1160518770, 1549947936 ])
solve([ 1064520033, 225182569, 1092639276, 510804079, 157746277, 1097729633, 1479294063, 140595744, 56885358, 1013979936, 326241121, 225183091, 360270437, 1310740270, 1534342227, 108149353, 6902304, 1193279598, 761350259, 359925356, 6379040, 140788078, 510673184, 1601176165, 291840880, 1194197106, 625102368, 627657074, 107414638, 359945760, 1277182063, 1310720097, 1081017698, 7088745, 477053216, 694486390, 1092623730, 208211048, 1399330151, 1047005472 ])
solve([241240421, 1244534132, 1045586720, 392430693, 1667434101])
solve([   1814056293, 73728616, 359929697, 410259232, 1310723695, 1248135789, 493434724, 74254197, 191647264, 1584878703, 1243636270, 426713667, 1248139126, 1294737010, 107040288, 660881774, 309546016, 510466665, 1701140077])
solve([207965296, 1160518770, 1549947936])
solve([2083524921, 57491744, 476974441, 494148213, 1551040869, 1344294188, 1534329715, 292694121, 6882930, 241637486, 376394784, 1248024675, 1936930657])
solve([208603241, 140581486, 90970732, 1462635897])
solve([ 844327968, 224991860, 1327497330, 174981225, 174788384, 342104425, 610615662, 1411390073, 325389154, 443418721, 388762227])
solve([ 292556645, 258873185, 57610016, 191174518, 253760882, 157625965, 443090276, 560793205, 157830944, 73466213, 774768244 ])
solve([ 641943328, 1013914479, 1394610795, 393352039, 644155493, 1092616814, 375718768, 527449200, 376570981, 1377847596 ])
solve([ 1198410081, 1243621476, 409865839, 1081018473, 1294729838, 309677600, 930365806, 225183081, 7557920, 157688687, 23401844, 392498030, 774791012 ])
solve([358967112, 460591969, 1081033504, 158079593, 258559008, 1293959534, 1344274529, 1633754988])
solve([1734803570])
solve([1142966885, 90266995, 459477109])

with open("./lib/armeabi/libcook.so", "rb") as libcook:
    libcook.seek(0x2f18)
    patched_ddex = bytearray(libcook.read(0x15a8))

data = [
0x49, 0x5E, 0x52, 0x5A, 0x79, 0x1B, 0x7B, 0x5A, 0x7C,
0x5B, 0x66, 0x5A, 0x5A, 0x5A, 0x48, 0x5A, 0x6F, 0x1A,
0x55, 0x5A, 0x12, 0x58, 0x5B, 0x5A, 0xE, 9, 0x5F, 0x5A,
0x12, 0x59, 0x59, 0x5A, 0xED, 0x68, 0xD7, 0x78, 0x15,
0x58, 0x5B, 0x5A, 0x82, 0x5A, 0x5A, 0x5B, 0x72, 0xA8,
0x78, 0x5A, 0x45, 0x5A, 0x2A, 0x7A, 0x7E, 0x5A, 0x4A,
0x5A, 0x40, 0x5B, 0x5A, 0x5A, 0x34, 0x7A, 0x7F, 0x5A,
0x4A, 0x5A, 0x50, 0x5A, 0x63, 0x5A, 0x47, 0x5A, 0xE ,
0xA, 0x58, 0x5A, 0x34, 0x4A, 0x5B, 0x5A, 0x5A, 0x5A ,
0x56, 0x5A, 0x78, 0x5B, 0x45, 0x5A, 0x38, 0x58, 0x5E,
0x5A, 0xE, 9, 0x5F, 0x5A, 0x2B, 0x7A, 0x78, 0x5A, 0x68,
0x5A, 0x56, 0x58, 0x2A, 0x7A, 0x7E, 0x5A, 0x7B, 0x5A,
0x48, 0x48, 0x2B, 0x6A, 0x4F, 0x5A, 0x4A, 0x58, 0x56,
0x5A, 0x34, 0x4A, 0x4C, 0x5A, 0x5A, 0x5A, 0x54, 0x5A,
0x5A, 0x59, 0x5B, 0x5A, 0x52, 0x5A, 0x5A, 0x5A, 0x40,
0x41, 0x44, 0x5E, 0x4F, 0x58, 0x48, 0x5D
]
for i in range(len(data)):
    patched_ddex[0x720 + i] = data[i] ^ 0x5A;
with open("./patached_ddex.dex", "wb") as _:
    _.write(patched_ddex)
-->
<h1 class="titlebar">Reference</h1>
<ol>
    <li><a href=https://github.com/tothi/ctfs/tree/master/google-ctf-2017/re/food""><b>Google CTF 2017 : Food</b></a></li>
</ol>
</body>
 <!-- ===========================================è”ç³»æ–¹å¼ & ç‰ˆæƒ============================================ -->
<br/><br/><br/>
<hr/>
<center>Contact me by <b>dXAyZ2Vla0AxNjMuY29tCg==</b><br/>OR<br/>Follow me on <a href="http://weibo.com/bugnofree" target="_blank">Sinablog</a> </center>
<hr/>
<center>Copyright &copy;2017 by bugnofree All rights reserved.</center>
<hr/>
</html>
